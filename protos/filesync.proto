syntax = "proto3";

package filesync;

service FileSyncService {
  // Client -> Server: Upload a file (chunked streaming)
  rpc UploadFile(stream FileChunk) returns (UploadResponse);

  // Client -> Server: Download a file (chunked streaming)
  rpc DownloadFile(FileRequest) returns (stream FileChunk);

  // List all files (for Sync)
  rpc ListFiles(ListFilesRequest) returns (FileListResponse);
}

message FileChunk {
  string file_name = 1;
  string file_hash = 2; // SHA256 of the full file (for verification)
  int32 chunk_index = 3;
  bytes data = 4;
  bool is_last_chunk = 5;
  int64 total_size = 6; // Sent in the first chunk
}

message UploadResponse {
  bool success = 1;
  string message = 2;
  string file_id = 3;
}

message FileRequest {
  string file_name = 1;
}

message ListFilesRequest {
  // Empty for now
}

message FileInfo {
  string file_name = 1;
  string file_hash = 2;
  int64 file_size = 3;
  int64 timestamp = 4;
}

message FileListResponse {
  repeated FileInfo files = 1;
}
