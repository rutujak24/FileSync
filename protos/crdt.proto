syntax = "proto3";
// CRDT protocol definitions

package filesync;

service CRDTService {
  // Client -> Server or Server -> Server: Apply a CRDT update
  rpc ApplyCRDTUpdate(CRDTOperation) returns (CRDTResponse);
  
  // Get the current CRDT state for a file
  rpc GetCRDTState(CRDTStateRequest) returns (CRDTStateResponse);
}

message CRDTOperation {
  enum Type {
    INSERT = 0;
    DELETE = 1;
  }
  Type type = 1;
  string file_name = 2;
  string site_id = 3;
  int32 clock = 4;
  
  // For RGA (Replicated Growable Array)
  // ID of the character to the left of the insertion point
  string origin_left_site = 5;
  int32 origin_left_clock = 6;
  
  string content = 7; // The character(s)
  
  // For Delete: ID of the character to delete
  string target_site = 8;
  int32 target_clock = 9;
}

message CRDTResponse {
  bool success = 1;
}

message CRDTStateRequest {
  string file_name = 1;
}

message CRDTStateResponse {
  // Serialized state (simplified for now: just the text content)
  string content = 1; 
  // In a real system, we'd send the full RGA structure
}
